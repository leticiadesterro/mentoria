<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PLANEJAMENTO 2026</title>

<style>
body{
font-family:Arial, sans-serif;
margin:20px;
background:#f4f6f9;
}

h1{
text-align:center;
}

input,button{
padding:14px;
font-size:18px;
margin:8px 0;
width:100%;
border-radius:8px;
border:1px solid #ccc;
box-sizing:border-box;
}

button{
background:#4F46E5;
color:white;
border:none;
font-weight:bold;
cursor:pointer;
}

.card{
background:white;
padding:18px;
margin:15px 0;
border-radius:12px;
box-shadow:0 4px 12px rgba(0,0,0,0.1);
transition:0.3s;
}

.card.finalizado{
background:#C7F9CC;
color:#1B4332;
opacity:0.95;
}

.card.assistida{
background:#D1FAE5;
color:#065F46;
opacity:0.95;
}

.fix{border-left:8px solid #e74c3c;}
.r7{border-left:8px solid #f39c12;}
.r15{border-left:8px solid #3498db;}
.r30{border-left:8px solid #2ecc71;}
.r90{border-left:8px solid #9b59b6;}

.total{
font-size:20px;
margin:25px 0;
font-weight:bold;
text-align:center;
}

.rendimento{
margin-top:10px;
font-weight:bold;
}
</style>
</head>

<body>

<h1>PROJETO LETI RESIDENTE 2027</h1>

<label>Escolha a data atual:</label>
<input type="date" id="dataEscolhida">
<button id="btnCalcular">CALCULAR</button>

<div id="saida"></div>

<div id="metaResumo" style="
margin-top:20px;
padding:14px;
border-radius:12px;
background:#EEF2FF;
color:#1E293B;
font-weight:600;
text-align:center;
box-shadow:0 4px 10px rgba(0,0,0,0.05);
"></div>

<script>

document.getElementById("btnCalcular").addEventListener("click", calcular);

const META_SEMANAL = 350;

const MINIMO = {
FIX:60,
R7:20,
R15:15,
R30:10,
R90:10
};

const DATA_INICIO = new Date(2026,0,10);
const CARNAVAL = "2026-02-14";

function parseDateLocal(dateString){
const parts = dateString.split("-");
return new Date(parts[0], parts[1]-1, parts[2]);
}

function inicioDaSemanaSabado(data){
let d = new Date(data);
let dia = d.getDay();
let diff = (dia - 6 + 7) % 7;
d.setDate(d.getDate() - diff);
d.setHours(0,0,0,0);
return d;
}

function intervaloSemana(data){
const inicio = inicioDaSemanaSabado(data);
const fim = new Date(inicio);
fim.setDate(fim.getDate() + 6);
return {inicio, fim};
}

function idFimDeSemana(data){

const sabado = inicioDaSemanaSabado(data);

const ano = sabado.getFullYear();
const mes = String(sabado.getMonth()+1).padStart(2,'0');
const dia = String(sabado.getDate()).padStart(2,'0');

return `${ano}-${mes}-${dia}`;
}
function numeroSemana(data){
const inicioSemana = inicioDaSemanaSabado(data);
const inicioBase = inicioDaSemanaSabado(DATA_INICIO);
const diff = inicioSemana.getTime() - inicioBase.getTime();
return Math.floor(diff/(1000*60*60*24*7)) + 1;
}

function ehSemanaCarnaval(data){
const inicioCarnaval = new Date(2026,1,14); // sábado
const fimCarnaval = new Date(2026,1,20); // sexta
return data >= inicioCarnaval && data <= fimCarnaval;
}

const aulas = [
["2026-01-10","SD ICTERICIA I (HEPATITES)"],
["2026-01-10","DOENCAS EXANTEMATICAS"],
["2026-01-17","SD ICTERICIA II (VIAS BILIARES)"],
["2026-01-17","SINDROME DE HIPERTENSAO PORTA"],
["2026-01-24","SINDROME DE INSUFICIENCIA HEPATICA"],
["2026-01-24","SINDROMES DE TRANSMISSAO SEXUAL"],
["2026-01-31","SINDROMES DISFAGICAS"],
["2026-01-31","SINDROMES RESPIRATORIAS NA INFANCIA (PARTE 1)"],
["2026-02-07","SINDROME DISPEPTICA E DOENCAS DO TGI SUPERIOR"],
["2026-02-07","SINDROMES RESPIRATORIAS NA INFANCIA (PARTE II)"],
["2026-02-21","SINDROME DIARREICA"],
["2026-02-21","HEMORRAGIA DIGESTIVA I - ABORDAGEM E CONDUTA"],
["2026-02-28","SINDROME METABOLICA I - HAS E DISLIPIDEMIA"],
["2026-02-28","HEMORRAGIA DIGESTIVA II - PROCTOLOGIA"],
["2026-03-07","SUS - EVOLUCAO HISTORICA, DIRETRIZES, PROPOSTAS E FINANCIAMENTO"],
["2026-03-07","SANGRAMENTO DA PRIMEIRA METADE DA GRAVIDEZ E DOENCAS HEMOLITICAS PERINATAIS"],
["2026-03-14","SINDROME ALGICA I - DOR ABDOMINAL"],
["2026-03-14","SANGRAMENTOS DA SEGUNDA METADE DA GRAVIDEZ"],
["2026-03-21","SINDROME METABOLICA II - DIABETES"],
["2026-03-21","IMUNIZACAO + INFECCAO DO TRATO URINARIO"],
["2026-03-28","GRANDES SINDROMES ENDOCRINAS PARTE I (TIREOIDE)"],
["2026-03-28","SINDROME DE OCLUSAO INTESTINAL (AGUDA X CRONICA) + HERNIAS"],
["2026-04-04","GRANDES SINDROMES ENDOCRINAS PARTE II (SUPRARRENAL/CALCIO); HIPOFUNCAO ADRENAL (DOENCA DE ADDISON)"],
["2026-04-04","ONCOLOGIA PARTE I - MAMA E OVARIO"],
["2026-04-11","TERAPIA INTENSIVA"],
["2026-04-11","MEDIDAS DE SAUDE COLETIVA"],
["2026-04-18","GRANDES SINDROMES BACTERIANAS PARTE I - PNEUMONIA"],
["2026-04-18","ONCOLOGIA PARTE II (ENDOMETRIO E COLO UTERINO)"],
["2026-04-25","ESTUDOS EPIDEMIOLOGICOS"],
["2026-04-25","DOENCAS CLINICAS NA GRAVIDEZ"],
["2026-05-02","GRANDES SINDROMES BACTERIANAS PARTE II - ENDOCARDITE E ITU"],
["2026-05-02","SINDROMES DE IMUNODEFICIENCIA"],
["2026-05-09","SINDROMES FEBRIS"],
["2026-05-16","TOSSE CRONICA"],
["2026-05-16","NEONATOLOGIA I"],
["2026-05-23","NEONATOLOGIA II"],
["2026-05-23","ONCOLOGIA II - ESOFAGO, ESTOMAGO, COLORRETAL E FIGADO"],
["2026-05-30","ONCOLOGIA II - PROSTATA, PULMAO E TIREOIDE"],
["2026-05-30","CRESCIMENTO E SEUS DISTURBIOS"],
["2026-05-30","CARENCIA DE MICRONUTRIENTES"],
["2026-06-06","PUBERDADE E SEUS DISTURBIOS"],
["2026-06-06","DESENVOLVIMENTO INFANTIL"],
["2026-06-13","DISPNEIA (DOENCAS VASCULARES, OBSTRUTIVAS E RESTRITIVAS)"],
["2026-06-13","SOFRIMENTO FETAL, AVALIACAO DE VITALIDADE FETAL, FORCEPS E PUERPERIO"],
["2026-06-20","GERIATRIA"],
["2026-06-20","EPILEPSIA"],
["2026-06-27","VIGILANCIA DA SAUDE E ETICA MEDICA"],
["2026-06-27","SINDROMES NEUROVASCULARES"],
["2026-07-04","DECLARACAO DE OBITO E SAUDE DO TRABALHADOR"],
["2026-07-04","FRAQUEZA MUSCULAR"],
["2026-07-11","DIAGNOSTICO DE GRAVIDEZ, MODIFICACOES DO ORGANISMO MATERNO, PRE-NATAL E ACONSELHAMENTO GENETICO"],
["2026-07-11","SINDROME ALGICA II - CEFALEIAS PRIMARIAS E SECUNDARIAS (ARTERITE DE CELULAS GIGANTES E MENINGITE)"],
["2026-07-18","CICLO MENSTRUAL, DISTOPIA GENITAL E INCONTINENCIA URINARIA"],
["2026-07-18","SINDROMES GLOMERULARES E DOENCA VASCULAR RENAL"],
["2026-07-25","SINDROMES ALGICAS III - DOR LOMBAR"],
["2026-07-25","SINDROME UREMICA"],
["2026-08-01","TRAUMA E SUAS CONSEQUENCIAS I"],
["2026-08-01","DISTURBIOS HIDROELETROLITICOS E ACIDO-BASE"],
["2026-08-08","TRAUMA E SUAS CONSEQUENCIAS II"],
["2026-08-08","ANEMIAS - PARTE I (CARENCIAIS)"],
["2026-08-15","ANEMIAS - PARTE II (HEMOLITICAS)"],
["2026-08-15","LEUCEMIAS E PANCITOPENIA"],
["2026-08-22","AMENORREIA"],
["2026-08-22","INFERTILIDADE E CLIMATERIO"],
["2026-08-29","LINFONODOMEGALIA"],
["2026-08-29","ANTICONCEPCAO, SANGRAMENTOS GINECOLOGICOS E ENDOMETRIOSE"],
["2026-09-05","DISTURBIOS DE HEMOSTASIA"],
["2026-09-05","TRANSTORNOS PSIQUIATRICOS I"],
["2026-09-12","ARTRITES"],
["2026-09-12","TRANSTORNOS PSIQUIATRICOS II"],
["2026-09-19","COLAGENOSES"],
["2026-09-19","VASCULITES"],
["2026-09-26","SINDROMES EDEMIGENICAS"],
["2026-09-26","O PARTO"],
["2026-10-03","SINDROMES ALGICAS IV - DOR TORACICA PARTE I"],
["2026-10-03","SINDROMES ALGICAS IV - DOR TORACICA PARTE II"],
["2026-10-10","TAQUIARRITMIAS"],
["2026-10-10","BRADIARRITMIAS"],
["2026-10-17","VALVOPATIAS"],
["2026-10-17","CARDIOPEDIATRIA"],
["2026-10-24","ALEITAMENTO MATERNO + DIARREIA AGUDA"],
["2026-10-24","PERIOPERATORIO I"],
["2026-10-31","PERIOPERATORIO II"],
["2026-10-31","INTOXICACAO E ACIDENTES POR ANIMAIS PEÇONHENTOS"],
["2026-11-07","PSIQUIATRIA I"],
["2026-11-07","PSIQUIATRIA II"],
["2026-11-14","OTORRINOLARINGOLOGIA"],
["2026-11-14","CIRURGIA DE CABECA E PESCOCO"],
["2026-11-21","OFTALMOLOGIA"],
["2026-11-21","ESPECIALIDADE CIRURGICA - PARTE I"],
["2026-11-21","ESPECIALIDADE CIRURGICA - PARTE II"],
["2026-11-21","DERMATOLOGIA I"],
["2026-11-21","DERMATOLOGIA II"],
["2026-11-21","ORTOPEDIA I"],
["2026-11-21","ORTOPEDIA II"]
];

function ajustarSemanaCarnaval(data){

const inicioSemana = inicioDaSemanaSabado(data);
const sabadoCarnaval = new Date(2026,1,14); // sábado correto

// apenas semanas QUE COMEÇAM depois do carnaval voltam uma casa
if(inicioSemana > sabadoCarnaval){
return numeroSemana(data) - 1;
}

return numeroSemana(data);
}

/* =========================
   SALVAMENTO AUTOMÁTICO
========================= */

function gerarChaveDia(data){

const ano = data.getFullYear();
const mes = String(data.getMonth()+1).padStart(2,'0');
const dia = String(data.getDate()).padStart(2,'0');

return `planner_${ano}-${mes}-${dia}`;
}

function salvarDadosDia(data){
    const chave = gerarChaveDia(data);

    const inputs = document.querySelectorAll("input");
    const estados = {};

    inputs.forEach(input=>{
        estados[input.id] = input.value;
    });

    localStorage.setItem(chave, JSON.stringify(estados));
}

function carregarDadosDia(data){
    const chave = gerarChaveDia(data);
    const salvo = localStorage.getItem(chave);

    if(!salvo) return;

    const estados = JSON.parse(salvo);

    Object.keys(estados).forEach(id=>{
        const el = document.getElementById(id);
        if(el){
            el.value = estados[id];
        }
    });
}

function totalFeitasSemana(dataAtual){

const {inicio, fim} = intervaloSemana(dataAtual);
let totalSemana = 0;
let totalDia = 0;

let dataLoop = new Date(inicio);

while(dataLoop <= fim){

const chave = gerarChaveDia(dataLoop);
const salvo = localStorage.getItem(chave);

if(salvo){
const estados = JSON.parse(salvo);

Object.keys(estados).forEach(id=>{
if(id.startsWith("feitas")){
const valor = parseInt(estados[id]) || 0;
totalSemana += valor;

if(dataLoop.toDateString() === dataAtual.toDateString()){
totalDia += valor;
}
}
});
}

dataLoop.setDate(dataLoop.getDate()+1);
}

return {totalSemana, totalDia};
}


function calcular(){

const dataInput = document.getElementById("dataEscolhida").value;
if(!dataInput){ alert("Escolha uma data."); return; }

const dataAtual = parseDateLocal(dataInput);
const diaSemana = dataAtual.getDay();

const sabadoSemana = inicioDaSemanaSabado(dataAtual);
const sabadoStr = idFimDeSemana(dataAtual);


const semanaAtual = ajustarSemanaCarnaval(dataAtual);
let ativos = [];

aulas.forEach(a=>{


const dataAula = parseDateLocal(a[0]);
let semanaAula = ajustarSemanaCarnaval(dataAula);


const diff = semanaAtual - semanaAula;

if(diff===0 && !ehSemanaCarnaval(dataAtual))
ativos.push({tema:a[1],fase:"FIX"});
if(diff===1)ativos.push({tema:a[1],fase:"R7"});
if(diff===2)ativos.push({tema:a[1],fase:"R15"});
if(diff===4)ativos.push({tema:a[1],fase:"R30"});
if(diff===12)ativos.push({tema:a[1],fase:"R90"});
});

ativos.sort((a,b)=>{
const ordem = ["FIX","R7","R15","R30","R90"];
return ordem.indexOf(a.fase) - ordem.indexOf(b.fase);
});

let totalMin=0;

ativos.forEach(x=>{
x.min = MINIMO[x.fase];
totalMin += x.min;
});

ativos.forEach(x=>{
x.sugerida = Math.round((x.min / totalMin) * META_SEMANAL);
});

// AJUSTAR METAS PELO QUE JÁ FOI FEITO (somente dias úteis)
if(diaSemana !== 6 && diaSemana !== 0){

ativos.forEach((x,index)=>{

let feitasTema = 0;

const {inicio, fim} = intervaloSemana(dataAtual);
let dataLoop = new Date(inicio);

while(dataLoop <= fim){

const chave = gerarChaveDia(dataLoop);
const salvo = localStorage.getItem(chave);

if(salvo){
const estados = JSON.parse(salvo);
const valor = parseInt(estados["feitas"+index]) || 0;
feitasTema += valor;
}

dataLoop.setDate(dataLoop.getDate()+1);
}

x.min = Math.max(0, x.min - feitasTema);
x.sugerida = Math.max(0, x.sugerida - feitasTema);

});

}

document.getElementById("metaResumo").innerHTML =
`Meta semanal recomendada: <strong>${totalMin}</strong> questões (mínimo necessário)
• Meta ideal: <strong>${META_SEMANAL}</strong> questões`;

let tituloSemana = ehSemanaCarnaval(dataAtual)
? "CARNAVAL"
: semanaAtual;

let html=`<div class="total">SEMANA ${tituloSemana}</div>`;

// CONTADOR (apenas dias úteis)
if(diaSemana !== 6 && diaSemana !== 0){

const totais = totalFeitasSemana(dataAtual);

html += `
<div class="card" style="background:#E0F2FE; font-weight:bold;">
QUESTÕES HOJE: ${totais.totalDia}<br>
QUESTÕES NA SEMANA: ${totais.totalSemana}
</div>
`;
}


/* FIM DE SEMANA */

const aulasSabado = aulas.filter(a => a[0] === sabadoStr);

if(diaSemana===6 || diaSemana===0){

// NÃO mostrar aulas se for carnaval
if(!ehSemanaCarnaval(dataAtual)){

aulasSabado.forEach((a,index)=>{
html+=`
<div class="card" id="aula${index}">
<strong>AULA — ${a[1]}</strong><br><br>
<button onclick="toggleAula(${index})">MARCAR COMO ASSISTIDA</button>
</div>`;
});

}



html+=`
<div class="card">
<strong>SIMULADO COMPLETO</strong><br><br>

<input type="number" placeholder="Número de questões" id="simFeitas" oninput="calcSimulado()">
<input type="number" placeholder="Erros" id="simErros" oninput="calcSimulado()">

<div class="rendimento" id="simRend">RENDIMENTO: -</div>
</div>
`;

document.getElementById("saida").innerHTML=html;

carregarDadosDia(dataAtual);

document.querySelectorAll("#saida input").forEach(input=>{
    input.addEventListener("input", ()=>{
        salvarDadosDia(dataAtual);
        calcular(); // força atualização automática da tela
    });
});



return;
}

/* SEMANA NORMAL */


ativos.forEach((x,index)=>{
html+=`
<div class="card ${x.fase.toLowerCase()}" id="card${index}">
<strong>${x.tema}</strong><br><br>

FASE: ${x.fase}<br><br>

QUESTÕES: ${x.min} (MIN) / ${x.sugerida} (SUGERIDA)<br><br>

MÉDIA DIÁRIA (5 DIAS): ${Math.ceil(x.min/5)} / ${Math.ceil(x.sugerida/5)}

<input type="number" placeholder="Quantas fiz" id="feitas${index}" oninput="calcularRendimento(${index})">
<input type="number" placeholder="Quantas errei" id="erros${index}" oninput="calcularRendimento(${index})">

<div class="rendimento" id="rend${index}">RENDIMENTO: -</div>

<button onclick="finalizar(${index})">FINALIZAR</button>
<button onclick="atualizarDia()">ATUALIZAR</button>

</div>
`;
});

// EXIBIR AULAS DO SÁBADO DURANTE A SEMANA (modo informativo)
if(diaSemana !== 6 && diaSemana !== 0 && !ehSemanaCarnaval(dataAtual)){

if(aulasSabado.length > 0){

html += `
<div class="card" style="background:#FEF9C3;">
<strong>AULAS DESTE SÁBADO:</strong><br><br>
`;

aulasSabado.forEach(a=>{
html += `• ${a[1]}<br>`;
});

html += `</div>`;
}

}

document.getElementById("saida").innerHTML=html;

carregarDadosDia(dataAtual);

document.querySelectorAll("#saida input").forEach(input=>{
    input.addEventListener("input", ()=>{
        salvarDadosDia(dataAtual);
    });
});

}


function calcularRendimento(i){
let feitas = parseInt(document.getElementById("feitas"+i).value) || 0;
let erros = parseInt(document.getElementById("erros"+i).value) || 0;

if(feitas>0 && erros<=feitas){
let acertos = feitas-erros;
let perc = ((acertos/feitas)*100).toFixed(1);
document.getElementById("rend"+i).innerHTML = "RENDIMENTO: "+perc+"%";
}else{
document.getElementById("rend"+i).innerHTML = "RENDIMENTO: -";
}
}

function calcSimulado(){
let feitas = parseInt(document.getElementById("simFeitas").value) || 0;
let erros = parseInt(document.getElementById("simErros").value) || 0;

if(feitas>0 && erros<=feitas){
let acertos = feitas-erros;
let perc = ((acertos/feitas)*100).toFixed(1);
document.getElementById("simRend").innerHTML = "RENDIMENTO: "+perc+"%";
}else{
document.getElementById("simRend").innerHTML = "RENDIMENTO: -";
}
}

function finalizar(i){

let card = document.getElementById("card"+i);
let botao = card.querySelector("button");

if(card.classList.contains("finalizado")){

card.classList.remove("finalizado");
botao.innerText = "FINALIZAR";

}else{

card.classList.add("finalizado");
botao.innerText = "REABRIR";

}

}

function toggleAula(i){

let card = document.getElementById("aula"+i);
let botao = card.querySelector("button");

if(card.classList.contains("assistida")){

card.classList.remove("assistida");
botao.innerText = "MARCAR COMO ASSISTIDA";

}else{

card.classList.add("assistida");
botao.innerText = "REABRIR AULA";

}

}

(function(){

const hoje = new Date();
const ano = hoje.getFullYear();
const mes = String(hoje.getMonth()+1).padStart(2,'0');
const dia = String(hoje.getDate()).padStart(2,'0');

const hojeFormatado = `${ano}-${mes}-${dia}`;

const inputData = document.getElementById("dataEscolhida");

if(inputData && !inputData.value){
inputData.value = hojeFormatado;
calcular();
}

})();

function atualizarDia(){

const dataInput = document.getElementById("dataEscolhida").value;
if(!dataInput) return;

const dataAtual = parseDateLocal(dataInput);

salvarDadosDia(dataAtual);
calcular();

}

</script>

</body>
</html>
