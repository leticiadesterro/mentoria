<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PLANEJAMENTO 2026</title>

<style>
body{
font-family:Arial, sans-serif;
margin:20px;
background:#f4f6f9;
}

h1{
text-align:center;
}

input,button{
padding:14px;
font-size:18px;
margin:8px 0;
width:100%;
border-radius:8px;
border:1px solid #ccc;
box-sizing:border-box;
}

button{
background:#111;
color:white;
border:none;
font-weight:bold;
cursor:pointer;
}

.card{
background:white;
padding:18px;
margin:15px 0;
border-radius:12px;
box-shadow:0 4px 12px rgba(0,0,0,0.1);
transition:0.3s;
}

.card.finalizado{
background:#444;
color:white;
opacity:0.85;
}

.fix{border-left:8px solid #e74c3c;}
.r7{border-left:8px solid #f39c12;}
.r15{border-left:8px solid #3498db;}
.r30{border-left:8px solid #2ecc71;}
.r90{border-left:8px solid #9b59b6;}

.total{
font-size:20px;
margin:25px 0;
font-weight:bold;
text-align:center;
}

.rendimento{
margin-top:10px;
font-weight:bold;
}
</style>
</head>

<body>

<h1>PLANEJAMENTO 2026</h1>

<label>Escolha a data atual:</label>
<input type="date" id="dataEscolhida">
<button id="btnCalcular">CALCULAR</button>

<div id="saida"></div>

<script>

document.getElementById("btnCalcular").addEventListener("click", calcular);

const META_SEMANAL = 350;

const MINIMO = {
FIX:60,
R7:20,
R15:15,
R30:10,
R90:10
};

const PRIORIDADE = ["FIX","R7","R15","R30","R90"];

const DATA_INICIO = new Date(2026,0,10);

function parseDateLocal(dateString){
const parts = dateString.split("-");
return new Date(parts[0], parts[1]-1, parts[2]);
}

function inicioDaSemanaSabado(data){
let d = new Date(data);
let dia = d.getDay();
let diff = (dia - 6 + 7) % 7;
d.setDate(d.getDate() - diff);
d.setHours(0,0,0,0);
return d;
}

function numeroSemana(data){
const inicioSemana = inicioDaSemanaSabado(data);
const inicioBase = inicioDaSemanaSabado(DATA_INICIO);
const diff = inicioSemana.getTime() - inicioBase.getTime();
return Math.floor(diff/(1000*60*60*24*7)) + 1;
}

const aulas = [
["2026-01-10","SD ICTERICIA I (HEPATITES)"],
["2026-01-10","DOENCAS EXANTEMATICAS"],
["2026-01-17","SD ICTERICIA II (VIAS BILIARES)"],
["2026-01-17","SINDROME DE HIPERTENSAO PORTA"]
// (mantive reduzido aqui no exemplo, mas pode manter sua lista inteira)
];

function calcular(){

const dataInput = document.getElementById("dataEscolhida").value;
if(!dataInput){ alert("Escolha uma data."); return; }

const dataAtual = parseDateLocal(dataInput);
const semanaAtual = numeroSemana(dataAtual);

let ativos = [];

aulas.forEach(a=>{
const dataAula = parseDateLocal(a[0]);
const semanaAula = numeroSemana(dataAula);
const diff = semanaAtual - semanaAula;

if(diff===0)ativos.push({tema:a[1],fase:"FIX"});
if(diff===1)ativos.push({tema:a[1],fase:"R7"});
if(diff===2)ativos.push({tema:a[1],fase:"R15"});
if(diff===4)ativos.push({tema:a[1],fase:"R30"});
if(diff===12)ativos.push({tema:a[1],fase:"R90"});
});

let totalMin=0;

ativos.forEach(x=>{
x.min = MINIMO[x.fase];
x.sugerida = x.min;
totalMin+=x.min;
});

let restante = META_SEMANAL - totalMin;

if(restante>0){
PRIORIDADE.forEach(fase=>{
let grupo = ativos.filter(x=>x.fase===fase);
if(grupo.length>0 && restante>0){
let add = Math.floor(restante/grupo.length);
grupo.forEach(x=>x.sugerida+=add);
restante -= add*grupo.length;
}
});

let i=0;
while(restante>0 && ativos.length>0){
ativos[i%ativos.length].sugerida+=1;
restante--;
i++;
}
}

let html=`<div class="total">SEMANA ${semanaAtual}</div>`;

if(ativos.length===0){
html+="NENHUM TEMA PROGRAMADO.";
document.getElementById("saida").innerHTML=html;
return;
}

ativos.forEach((x,index)=>{
html+=`
<div class="card ${x.fase.toLowerCase()}" id="card${index}">
<strong>${x.tema}</strong><br><br>
FASE: ${x.fase}<br><br>
QUESTOES: ${x.min} (MIN) / ${x.sugerida} (SUGERIDA)<br><br>
MEDIA DIARIA (5 DIAS): ${Math.ceil(x.min/5)} / ${Math.ceil(x.sugerida/5)}

<br><br>

<input type="number" placeholder="QUANTAS FIZ" id="feitas${index}" oninput="calcularRendimento(${index})">
<input type="number" placeholder="QUANTAS ERREI" id="erros${index}" oninput="calcularRendimento(${index})">

<div class="rendimento" id="rend${index}">RENDIMENTO: -</div>

<button onclick="finalizar(${index})">FINALIZAR</button>

</div>
`;
});

document.getElementById("saida").innerHTML=html;
}

function calcularRendimento(i){
let feitas = parseInt(document.getElementById("feitas"+i).value) || 0;
let erros = parseInt(document.getElementById("erros"+i).value) || 0;

if(feitas>0 && erros<=feitas){
let acertos = feitas - erros;
let perc = ((acertos/feitas)*100).toFixed(1);
document.getElementById("rend"+i).innerHTML = "RENDIMENTO: " + perc + "%";
}else{
document.getElementById("rend"+i).innerHTML = "RENDIMENTO: -";
}
}

function finalizar(i){
let card = document.getElementById("card"+i);
card.classList.add("finalizado");
document.getElementById("saida").appendChild(card);
}

</script>

</body>
</html>
