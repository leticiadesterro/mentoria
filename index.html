<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PLANEJAMENTO 2026</title>

<style>
body{
font-family:Arial, sans-serif;
margin:20px;
background:#f4f6f9;
}
h1{text-align:center;}
input,button{
padding:14px;
font-size:18px;
margin:8px 0;
width:100%;
border-radius:8px;
border:1px solid #ccc;
box-sizing:border-box;
}
button{
background:#4F46E5;
color:white;
border:none;
font-weight:bold;
cursor:pointer;
}
.card{
background:white;
padding:18px;
margin:15px 0;
border-radius:12px;
box-shadow:0 4px 12px rgba(0,0,0,0.1);
transition:0.3s;
}
.card.finalizado{
background:#C7F9CC;
color:#1B4332;
opacity:0.95;
}
.fix{border-left:8px solid #e74c3c;}
.r7{border-left:8px solid #f39c12;}
.r15{border-left:8px solid #3498db;}
.r30{border-left:8px solid #2ecc71;}
.r90{border-left:8px solid #9b59b6;}
.total{
font-size:20px;
margin:25px 0;
font-weight:bold;
text-align:center;
}
.rendimento{margin-top:10px;font-weight:bold;}
</style>
</head>

<body>

<h1>PROJETO LETI RESIDENTE 2027</h1>

<label>Escolha a data atual:</label>
<input type="date" id="dataEscolhida">
<button onclick="calcular()">CALCULAR</button>

<div id="saida"></div>
<div id="metaResumo" style="
margin-top:20px;
padding:14px;
border-radius:12px;
background:#EEF2FF;
color:#1E293B;
font-weight:600;
text-align:center;
box-shadow:0 4px 10px rgba(0,0,0,0.05);
"></div>

<script>

const META_SEMANAL = 350;

const MINIMO = {
FIX:60,
R7:20,
R15:15,
R30:10,
R90:10
};

const DATA_INICIO = new Date(2026,0,10);
const CARNAVAL = "2026-02-14";

/* ================= FUNÇÕES BASE ================= */

function parseDateLocal(dateString){
const parts = dateString.split("-");
return new Date(parts[0], parts[1]-1, parts[2]);
}

function inicioDaSemanaSabado(data){
let d = new Date(data);
let diff = (d.getDay() - 6 + 7) % 7;
d.setDate(d.getDate() - diff);
d.setHours(0,0,0,0);
return d;
}

function numeroSemana(data){
const inicioSemana = inicioDaSemanaSabado(data);
const inicioBase = inicioDaSemanaSabado(DATA_INICIO);
const diff = inicioSemana.getTime() - inicioBase.getTime();
return Math.floor(diff/(1000*60*60*24*7)) + 1;
}

function ajustarSemanaCarnaval(data){
if(data >= new Date(2026,1,16)){
return numeroSemana(data)-1;
}
return numeroSemana(data);
}

/* ================= SUA LISTA INTACTA ================= */

const aulas = [
["2026-01-10","SD ICTERICIA I (HEPATITES)"],
["2026-01-10","DOENCAS EXANTEMATICAS"],
["2026-01-17","SD ICTERICIA II (VIAS BILIARES)"],
["2026-01-17","SINDROME DE HIPERTENSAO PORTA"],
["2026-01-24","SINDROME DE INSUFICIENCIA HEPATICA"],
["2026-01-24","SINDROMES DE TRANSMISSAO SEXUAL"],
["2026-01-31","SINDROMES DISFAGICAS"],
["2026-01-31","SINDROMES RESPIRATORIAS NA INFANCIA (PARTE 1)"],
["2026-02-07","SINDROME DISPEPTICA E DOENCAS DO TGI SUPERIOR"],
["2026-02-07","SINDROMES RESPIRATORIAS NA INFANCIA (PARTE II)"],
["2026-02-14","SINDROME DIARREICA"],
["2026-02-14","HEMORRAGIA DIGESTIVA I - ABORDAGEM E CONDUTA"],
["2026-02-21","SINDROME METABOLICA I - HAS E DISLIPIDEMIA"],
["2026-02-21","HEMORRAGIA DIGESTIVA II - PROCTOLOGIA"],
["2026-02-28","SUS - EVOLUCAO HISTORICA, DIRETRIZES, PROPOSTAS E FINANCIAMENTO"],
["2026-02-28","SANGRAMENTO DA PRIMEIRA METADE DA GRAVIDEZ E DOENCAS HEMOLITICAS PERINATAIS"],
["2026-03-07","SINDROME ALGICA I - DOR ABDOMINAL"],
["2026-03-07","SANGRAMENTOS DA SEGUNDA METADE DA GRAVIDEZ"],
["2026-03-14","SINDROME METABOLICA II - DIABETES"],
["2026-03-14","IMUNIZACAO + INFECCAO DO TRATO URINARIO"],
["2026-03-21","GRANDES SINDROMES ENDOCRINAS PARTE I (TIREOIDE)"],
["2026-03-21","SINDROME DE OCLUSAO INTESTINAL (AGUDA X CRONICA) + HERNIAS"],
["2026-03-28","GRANDES SINDROMES ENDOCRINAS PARTE II (SUPRARRENAL/CALCIO); HIPOFUNCAO ADRENAL (DOENCA DE ADDISON)"],
["2026-03-28","ONCOLOGIA PARTE I - MAMA E OVARIO"],
["2026-04-04","TERAPIA INTENSIVA"],
["2026-04-04","MEDIDAS DE SAUDE COLETIVA"],
["2026-04-11","GRANDES SINDROMES BACTERIANAS PARTE I - PNEUMONIA"],
["2026-04-11","ONCOLOGIA PARTE II (ENDOMETRIO E COLO UTERINO)"],
["2026-04-18","ESTUDOS EPIDEMIOLOGICOS"],
["2026-04-18","DOENCAS CLINICAS NA GRAVIDEZ"],
["2026-04-25","GRANDES SINDROMES BACTERIANAS PARTE II - ENDOCARDITE E ITU"],
["2026-04-25","SINDROMES DE IMUNODEFICIENCIA"],
["2026-05-02","SINDROMES FEBRIS"],
["2026-05-09","TOSSE CRONICA"],
["2026-05-09","NEONATOLOGIA I"],
["2026-05-16","NEONATOLOGIA II"],
["2026-05-16","ONCOLOGIA II - ESOFAGO, ESTOMAGO, COLORRETAL E FIGADO"],
["2026-05-23","ONCOLOGIA II - PROSTATA, PULMAO E TIREOIDE"],
["2026-05-23","CRESCIMENTO E SEUS DISTURBIOS"],
["2026-05-23","CARENCIA DE MICRONUTRIENTES"],
["2026-05-30","PUBERDADE E SEUS DISTURBIOS"],
["2026-05-30","DESENVOLVIMENTO INFANTIL"],
["2026-06-06","DISPNEIA (DOENCAS VASCULARES, OBSTRUTIVAS E RESTRITIVAS)"],
["2026-06-06","SOFRIMENTO FETAL, AVALIACAO DE VITALIDADE FETAL, FORCEPS E PUERPERIO"],
["2026-06-13","GERIATRIA"],
["2026-06-13","EPILEPSIA"],
["2026-06-20","VIGILANCIA DA SAUDE E ETICA MEDICA"],
["2026-06-20","SINDROMES NEUROVASCULARES"],
["2026-06-27","DECLARACAO DE OBITO E SAUDE DO TRABALHADOR"],
["2026-06-27","FRAQUEZA MUSCULAR"],
["2026-07-04","DIAGNOSTICO DE GRAVIDEZ, MODIFICACOES DO ORGANISMO MATERNO, PRE-NATAL E ACONSELHAMENTO GENETICO"],
["2026-07-04","SINDROME ALGICA II - CEFALEIAS PRIMARIAS E SECUNDARIAS"],
["2026-07-11","CICLO MENSTRUAL, DISTOPIA GENITAL E INCONTINENCIA URINARIA"],
["2026-07-11","SINDROMES GLOMERULARES E DOENCA VASCULAR RENAL"],
["2026-07-18","SINDROMES ALGICAS III - DOR LOMBAR"],
["2026-07-18","SINDROME UREMICA"],
["2026-07-25","TRAUMA E SUAS CONSEQUENCIAS I"],
["2026-07-25","DISTURBIOS HIDROELETROLITICOS E ACIDO-BASE"]
];

/* ================= SISTEMA ================= */

function calcular(){

const dataInput = document.getElementById("dataEscolhida").value;
if(!dataInput){ alert("Escolha uma data."); return; }

const dataAtual = parseDateLocal(dataInput);
const diaSemana = dataAtual.getDay();
const sabadoBase = inicioDaSemanaSabado(dataAtual);
const semanaAtual = ajustarSemanaCarnaval(sabadoBase);

const chave = (diaSemana===6 || diaSemana===0)
? "SEMANA_"+semanaAtual+"_FDS"
: "SEMANA_"+semanaAtual;

let dadosSalvos = JSON.parse(localStorage.getItem(chave)) || {};

let ativos = [];

aulas.forEach(a=>{
const dataAula = parseDateLocal(a[0]);
let semanaAula = ajustarSemanaCarnaval(inicioDaSemanaSabado(dataAula));
const diff = semanaAtual - semanaAula;

if(diff===0)ativos.push({tema:a[1],fase:"FIX"});
if(diff===1)ativos.push({tema:a[1],fase:"R7"});
if(diff===2)ativos.push({tema:a[1],fase:"R15"});
if(diff===4)ativos.push({tema:a[1],fase:"R30"});
if(diff===12)ativos.push({tema:a[1],fase:"R90"});
});

ativos.sort((a,b)=>{
const ordem = ["FIX","R7","R15","R30","R90"];
return ordem.indexOf(a.fase) - ordem.indexOf(b.fase);
});

let totalMin=0;
ativos.forEach(x=>{ x.min = MINIMO[x.fase]; totalMin+=x.min; });

ativos.forEach(x=>{
x.sugerida = Math.round((x.min/totalMin)*META_SEMANAL);
});

let html=`<div class="total">SEMANA ${semanaAtual}</div>`;

ativos.forEach((x,index)=>{

if(!dadosSalvos[index]) dadosSalvos[index]={feitas:"",erros:"",finalizado:false};

html+=`
<div class="card ${x.fase.toLowerCase()} ${dadosSalvos[index].finalizado?"finalizado":""}" id="card${index}">
<strong>${x.tema}</strong><br><br>
FASE: ${x.fase}<br><br>
QUESTÕES: ${x.min} (MIN) / ${x.sugerida} (SUGERIDA)<br><br>

<input type="number" placeholder="Quantas fiz"
value="${dadosSalvos[index].feitas}"
oninput="salvar('${chave}',${index},'feitas',this.value)">

<input type="number" placeholder="Quantas errei"
value="${dadosSalvos[index].erros}"
oninput="salvar('${chave}',${index},'erros',this.value)">

<div class="rendimento" id="rend${index}">
${calcularPercentual(dadosSalvos[index].feitas,dadosSalvos[index].erros)}
</div>

<button onclick="toggleFinal('${chave}',${index})">
${dadosSalvos[index].finalizado?"REABRIR":"FINALIZAR"}
</button>
</div>
`;
});

localStorage.setItem(chave,JSON.stringify(dadosSalvos));
document.getElementById("saida").innerHTML=html;
}

function salvar(chave,i,tipo,valor){
let dados = JSON.parse(localStorage.getItem(chave)) || {};
if(!dados[i]) dados[i]={};
dados[i][tipo]=valor;
localStorage.setItem(chave,JSON.stringify(dados));
calcular();
}

function toggleFinal(chave,i){
let dados = JSON.parse(localStorage.getItem(chave)) || {};
if(!dados[i]) dados[i]={};
dados[i].finalizado=!dados[i].finalizado;
localStorage.setItem(chave,JSON.stringify(dados));
calcular();
}

function calcularPercentual(feitas,erros){
feitas=parseInt(feitas)||0;
erros=parseInt(erros)||0;
if(feitas>0 && erros<=feitas){
let acertos=feitas-erros;
return "RENDIMENTO: "+((acertos/feitas)*100).toFixed(1)+"%";
}
return "RENDIMENTO: -";
}

</script>
</body>
</html>
